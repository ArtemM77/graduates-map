
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ö –ö–û–ú–£ –û–ë–†–ê–¢–ò–¢–¨–°–Ø –î–õ–Ø –ó–ê–ú–û–†–û–ó–ö–ò –°–ü–ï–†–ú–´ –ñ–ò–í–û–¢–ù–´–•?</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <style>
    html, body, #map {{ height: 100%; margin: 0; }}
    .doctor-card {{
        display: flex;
        flex-direction: row;
        max-width: 500px;
        font-family: sans-serif;
    }}
    .doctor-photo {{
        width: 150px;
        height: 150px;
        object-fit: cover;
        border-radius: 4px;
        margin-right: 15px;
    }}
    .doctor-info {{
        font-size: 14px;
    }}
    .doctor-info h3 {{
        margin: 0;
    }}
    .doctor-info a {{
        text-decoration: none;
    }}
  </style>
</head>
<body>
  <div id="map"></div>
  <script>
    var map = L.map('map').setView([56.5, 45], 5);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {{
        maxZoom: 18
    }}).addTo(map);

    function createDoctorCard(data) {{
        return `
        <div class="doctor-card">
            <img class="doctor-photo" src="https://artemm77.github.io/graduates-map/${{data['–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –¥–æ–∫—Ç–æ—Ä–∞'] || 'no-photo.png'}}" />
            <div class="doctor-info">
                <h3>${{data['–§–ò–û']}}</h3>
                <strong>${{data['–î–æ–ª–∂–Ω–æ—Å—Ç—å']}}</strong><br />
                ${{data['–ö–ª–∏–Ω–∏–∫–∞']}}<br />
                <p><strong>–£—Å–ª—É–≥–∏ –ø–æ —Ä–µ–ø—Ä–æ–¥—É–∫—Ü–∏–∏:</strong><br />${{data['–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏'].replace(/,/g, '<br />')}}</p>
                <p>üìç <a href="https://maps.google.com/?q=${{encodeURIComponent(data['–ê–¥—Ä–µ—Å'])}}" target="_blank">${{data['–ê–¥—Ä–µ—Å']}}</a><br />
                ‚òé <a href="tel:${{data['–¢–µ–ª–µ—Ñ–æ–Ω']}}">${{data['–¢–µ–ª–µ—Ñ–æ–Ω']}}</a><br />
                üåê <a href="${{data['–°–∞–π—Ç']}}" target="_blank">${{data['–°–∞–π—Ç']}}</a></p>
            </div>
        </div>`;
    }}

    fetch('doctors.csv')
      .then(response => response.text())
      .then(csvText => {{
        Papa.parse(csvText, {{
          header: true,
          skipEmptyLines: true,
          complete: function(results) {{
            const grouped = {{}};
            results.data.forEach(row => {{
              if (!row['–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã']) return;
              const key = row['–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã'].trim();
              if (!grouped[key]) grouped[key] = [];
              grouped[key].push(row);
            }});

            for (const key in grouped) {{
              const [lat, lon] = key.split(',').map(parseFloat);
              const group = grouped[key];
              const markerIcon = L.icon({{
                iconUrl: 'https://artemm77.github.io/graduates-map/' + group[0]['–õ–æ–≥–æ—Ç–∏–ø –∫–ª–∏–Ω–∏–∫–∏'],
                iconSize: [60, 90],
                iconAnchor: [30, 90],
                popupAnchor: [0, -90]
              }});

              let photosHTML = '';
              if (group.length === 1) {{
                photosHTML = `<img class='doctor-photo' src='https://artemm77.github.io/graduates-map/${{group[0]['–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –¥–æ–∫—Ç–æ—Ä–∞']}}' />`;
              }} else {{
                photosHTML = group.map(doc => `
                  <div style="display:flex;align-items:center;margin-bottom:5px;">
                    <img class='doctor-photo' src='https://artemm77.github.io/graduates-map/${{doc['–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –¥–æ–∫—Ç–æ—Ä–∞']}}' />
                    <div class='doctor-info'><strong>${{doc['–§–ò–û']}}</strong></div>
                  </div>`).join('');
              }}

              const popupContent = `
                <div class='doctor-card'>
                  <div style='display:flex;flex-direction:column'>${photosHTML}</div>
                  <div class='doctor-info'>
                    <strong>${{group[0]['–î–æ–ª–∂–Ω–æ—Å—Ç—å']}}</strong><br />
                    ${{group[0]['–ö–ª–∏–Ω–∏–∫–∞']}}<br />
                    <p><strong>–£—Å–ª—É–≥–∏ –ø–æ —Ä–µ–ø—Ä–æ–¥—É–∫—Ü–∏–∏:</strong><br />${{group[0]['–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏'].replace(/,/g, '<br />')}}</p>
                    <p>üìç <a href="https://maps.google.com/?q=${{encodeURIComponent(group[0]['–ê–¥—Ä–µ—Å'])}}" target="_blank">${{group[0]['–ê–¥—Ä–µ—Å']}}</a><br />
                    ‚òé <a href="tel:${{group[0]['–¢–µ–ª–µ—Ñ–æ–Ω']}}">${{group[0]['–¢–µ–ª–µ—Ñ–æ–Ω']}}</a><br />
                    üåê <a href="${{group[0]['–°–∞–π—Ç']}}" target="_blank">${{group[0]['–°–∞–π—Ç']}}</a></p>
                  </div>
                </div>
              `;

              L.marker([lat, lon], {{ icon: markerIcon }})
                .addTo(map)
                .bindPopup(popupContent);
            }}
          }}
        }});
      }});
  </script>
</body>
</html>
