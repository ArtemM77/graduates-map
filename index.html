<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ì–¥–µ –∑–∞–º–æ—Ä–æ–∑–∏—Ç—å —Å–ø–µ—Ä–º—É –∫–æ–±–µ–ª—è?</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
  <div id="map" style="width: 100%; height: 100vh;"></div>

  <script>
    var map = L.map('map').setView([56.5, 50.5], 4);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);

    function logDoctorView(doctorName, eventType = "card_opened") {
      const url = "https://script.google.com/macros/s/AKfycbyFyGbiTvE-9CnTgMKBYxx70cXgtXiaE3KW1-2GzMuPVTvRz5FasnQ7aOdkq2hnB9t1/exec";
      fetch(url, {
        method: "POST",
        mode: "no-cors",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          name: doctorName,
          event: eventType,
          timestamp: new Date().toISOString()
        })
      }).catch(() => {});
    }

    function createPopupHTML(doctor) {
      logDoctorView(doctor.name, 'card_opened');
      const isMobile = window.innerWidth < 768;

      const contactButtons = `
        <a onclick="logDoctorView('${doctor.name}', 'click_yandex_maps')" href="https://yandex.ru/maps/?text=${doctor.address}" target="_blank" style="background: white; border: 1px solid #ccc; border-radius: 6px; padding: 8px 10px; font-size: 10px; text-decoration: none; color: black; text-align: center;">${doctor.address}</a>
        <a onclick="logDoctorView('${doctor.name}', 'click_phone')" href="tel:${doctor.phone}" style="background: white; border: 1px solid #ccc; border-radius: 6px; padding: 8px 10px; font-size: 10px; text-decoration: none; color: black; text-align: center;">üìû ${doctor.phone}</a>
        <a onclick="logDoctorView('${doctor.name}', 'click_website')" href="${doctor.site}" target="_blank" style="background: white; border: 1px solid #ccc; border-radius: 6px; padding: 8px 10px; font-size: 10px; text-decoration: none; color: black; text-align: center;">üåê –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç</a>
      `;

      const iconsBlock = `
        <div style="margin-top: 10px; text-align: center;">
          <div style="display: flex; justify-content: center; gap: 12px;">
            <a onclick="logDoctorView('${doctor.name}', 'click_yandex_navi')" href="yandexnavi://build_route_on_map?lat_to=${doctor.lat}&lon_to=${doctor.lng}" title="–Ø–Ω–¥–µ–∫—Å.–ù–∞–≤–∏–≥–∞—Ç–æ—Ä">
              <img src="https://artemm77.github.io/graduates-map/yandex.png" alt="–ù–∞–≤–∏–≥–∞—Ç–æ—Ä" style="width: 50px; height: 50px;" />
            </a>
            <a onclick="logDoctorView('${doctor.name}', 'click_whatsapp')" href="https://wa.me/${doctor.phone.replace(/[^0-9]/g, '')}" target="_blank" title="WhatsApp">
              <img src="https://artemm77.github.io/graduates-map/whatsapp.png" alt="WhatsApp" style="width: 50px; height: 50px;" />
            </a>
            <a onclick="logDoctorView('${doctor.name}', 'click_telegram')" href="https://t.me/${doctor.phone.replace(/[^0-9]/g, '')}" target="_blank" title="Telegram">
              <img src="https://artemm77.github.io/graduates-map/telegram.png" alt="Telegram" style="width: 50px; height: 50px;" />
            </a>
          </div>
        </div>
      `;

      if (isMobile) {
        return `
          <div style="display: flex; flex-direction: column; gap: 15px; width: 100%; max-width: 85vw; max-height: 85vh; overflow-y: auto; font-size: 13px; color: #222; font-family: sans-serif;">
            <style> ::-webkit-scrollbar { display: none; } </style>
            <img src="https://artemm77.github.io/graduates-map/${doctor.photo}" style="width: 100%; border-radius: 4px;" />
            <div>
              <h3 style="margin: 0; font-size: 15px;">${doctor.name}</h3>
              <p style="margin: 0;">${doctor.title}<br><strong>${doctor.clinic}</strong></p>
            </div>
            <p style="margin: 0;">
              <span style="text-decoration: underline;">–£—Å–ª—É–≥–∏ –ø–æ —Ä–µ–ø—Ä–æ–¥—É–∫—Ü–∏–∏:</span><br>
              ${doctor.services}
            </p>
            <div style="display: flex; flex-direction: column; gap: 8px; align-items: stretch;">
              ${contactButtons}
            </div>
            ${iconsBlock}
          </div>
        `;
      } else {
        return `
          <div style="display: flex; flex-direction: row; gap: 20px; width: 100%; max-width: 400px; font-size: 13px; color: #222; font-family: sans-serif;">
            <div style="flex: 1.3;">
              <img src="https://artemm77.github.io/graduates-map/${doctor.photo}" style="width: 100%; border-radius: 4px;" />
              <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 15px;">
                ${contactButtons}
              </div>
              ${iconsBlock}
            </div>
            <div style="flex: 1.7;">
              <h3 style="margin: 0; font-size: 15px;">${doctor.name}</h3>
              <p style="margin: 0;">${doctor.title}<br><strong>${doctor.clinic}</strong></p>
              <p style="margin-top: 10px;">
                <span style="text-decoration: underline;">–£—Å–ª—É–≥–∏ –ø–æ —Ä–µ–ø—Ä–æ–¥—É–∫—Ü–∏–∏:</span><br>
                ${doctor.services}
              </p>
            </div>
          </div>
        `;
      }
    }

    // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤ doctors –∏ –ª–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤
  </script>
</body>
</html>
