
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö –ö–û–ú–£ –û–ë–†–ê–¢–ò–¢–¨–°–Ø –î–õ–Ø –ó–ê–ú–û–†–û–ó–ö–ò –°–ü–ï–†–ú–´ –ñ–ò–í–û–¢–ù–´–•?</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        #map { width: 100%; height: 100vh; }
        .popup-content {
            font-family: Arial, sans-serif;
            width: 350px;
        }
        .popup-content img {
            width: 120px;
            height: 120px;
            object-fit: cover;
            float: left;
            margin-right: 10px;
        }
        .popup-content div {
            overflow: hidden;
        }
        .popup-content a {
            color: blue;
            text-decoration: none;
        }
    </style>
</head>
<body>
<div id="map"></div>

<script>
    var map = L.map('map').setView([55.751244, 37.618423], 4);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap'
    }).addTo(map);

    $.get('doctors.csv', function(csvData) {
        let data = csvData.split("\n").slice(1);
        data.forEach(function(row) {
            let cols = row.split(',');
            if (cols.length < 10) return; // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
            
            let [clinic, address, coords, city, logo, phone, site, services, names, photos] = cols;
            let latlng = coords.split(';').map(Number);

            let photoHtml = '';
            photos.split(';').forEach(photo => {
                photoHtml += `<img src="${photo.trim()}" alt="–§–æ—Ç–æ –¥–æ–∫—Ç–æ—Ä–∞">`;
            });

            let popupContent = `
                <div class="popup-content">
                    ${photoHtml}
                    <div>
                        <strong>${names}</strong><br>
                        ${clinic}<br>
                        <b>–£—Å–ª—É–≥–∏ –ø–æ —Ä–µ–ø—Ä–æ–¥—É–∫—Ü–∏–∏:</b><br>${services}<br>
                        üìç <a href="https://yandex.ru/maps/?text=${encodeURIComponent(address)}" target="_blank">${address}</a><br>
                        üìû <a href="tel:${phone}">${phone}</a><br>
                        üåê <a href="${site}" target="_blank">${site}</a>
                    </div>
                </div>`;

            let icon = L.icon({
                iconUrl: logo.trim(),
                iconSize: [50, 50],
                iconAnchor: [25, 50],
                popupAnchor: [0, -50]
            });

            L.marker(latlng, {icon: icon}).addTo(map).bindPopup(popupContent);
        });
    });
</script>
</body>
</html>
